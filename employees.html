<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <title>Employees - Cliente</title>
  <style>
    body{font-family: Arial, sans-serif;max-width:900px;margin:32px}
    table{width:100%;border-collapse:collapse;margin-top:16px}
    th,td{border:1px solid #ddd;padding:8px;text-align:left}
    th{background:#f5f5f5}
    form>input, form>button{margin-right:8px;padding:6px}
  </style>
</head>
<body>
  <h1>Employees (consumindo API local)</h1>

  <section>
    <h2>Cadastrar funcionário</h2>
    <form id="form">
      <input type="text" id="name" placeholder="Nome" required />
      <input type="text" id="address" placeholder="Endereço" required />
      <button type="submit">Criar</button>
    </form>
    <div id="msg" aria-live="polite"></div>
  </section>

  <section>
    <h2>Lista de funcionários</h2>
    <button id="refresh">Atualizar</button>
    <table id="table">
      <thead>
        <tr><th>ID</th><th>Nome</th><th>Endereço</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <section>
    <h2>Produtos (API /products)</h2>
    <form id="productFormApi">
      <input type="text" id="p_name" placeholder="Nome do produto" required />
      <input type="number" id="p_price" placeholder="Preço" step="0.01" required />
      <input type="text" id="p_description" placeholder="Descrição" />
      <label><input type="checkbox" id="p_instock" /> Em estoque</label>
      <button type="submit">Criar Produto</button>
    </form>
    <button id="refreshProducts">Atualizar Produtos</button>
    <table id="tableProducts">
      <thead>
        <tr><th>ID</th><th>Nome</th><th>Preço</th><th>Descrição</th><th>Em estoque</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <script>
  const API = 'http://localhost:8080/employees';
  const PRODUCTS_API = 'http://localhost:8080/products';

    async function listEmployees(){
      try{
        const res = await fetch(API, {method:'GET'});
        if(!res.ok) throw new Error('Falha ao consultar: '+res.status);
        const data = await res.json();
        const tbody = document.querySelector('#table tbody');
        tbody.innerHTML = '';
        (data||[]).forEach(e => {
          const tr = document.createElement('tr');
          tr.innerHTML = `<td>${e.id}</td><td>${escapeHtml(e.name)}</td><td>${escapeHtml(e.address)}</td>`;
          tbody.appendChild(tr);
        });
      }catch(err){
        showMsg('Erro: '+err.message, true);
      }
    }

    async function createEmployee(payload){
      try{
        const res = await fetch(API, {
          method:'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify(payload)
        });
        if(!res.ok) throw new Error('Falha ao criar: '+res.status);
        const created = await res.json();
        showMsg('Criado ID: '+created.id);
        await listEmployees();
      }catch(err){
        showMsg('Erro: '+err.message, true);
      }
    }

    document.getElementById('form').addEventListener('submit', e=>{
      e.preventDefault();
      const name = document.getElementById('name').value.trim();
      const address = document.getElementById('address').value.trim();
      if(!name || !address){ showMsg('Preencha todos os campos', true); return; }
      createEmployee({name, address});
      e.target.reset();
    });

    document.getElementById('refresh').addEventListener('click', ()=>listEmployees());

    function showMsg(text, isError=false){
      const el = document.getElementById('msg');
      el.textContent = text;
      el.style.color = isError ? 'crimson' : 'green';
      setTimeout(()=>el.textContent = '', 4000);
    }

    function escapeHtml(str){
      return String(str)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#039;');
    }

    // auto-load
    listEmployees();
    listProducts();

    // Products API functions
    async function listProducts(){
      try{
        const res = await fetch(PRODUCTS_API, {method:'GET'});
        if(!res.ok) throw new Error('Falha ao consultar produtos: '+res.status);
        const data = await res.json();
        const tbody = document.querySelector('#tableProducts tbody');
        tbody.innerHTML = '';
        (data||[]).forEach(p => {
          const tr = document.createElement('tr');
          tr.innerHTML = `<td>${p.id}</td><td>${escapeHtml(p.name)}</td><td>R$ ${Number(p.price).toFixed(2)}</td><td>${escapeHtml(p.description||'')}</td><td>${p.in_stock? 'Sim':'Não'}</td>`;
          tbody.appendChild(tr);
        });
      }catch(err){ showMsg('Erro produtos: '+err.message, true); }
    }

    async function createProduct(payload){
      try{
        const res = await fetch(PRODUCTS_API, {
          method:'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify(payload)
        });
        if(!res.ok) throw new Error('Falha ao criar produto: '+res.status);
        const created = await res.json();
        showMsg('Produto criado ID: '+created.id);
        await listProducts();
      }catch(err){ showMsg('Erro: '+err.message, true); }
    }

    document.getElementById('productFormApi').addEventListener('submit', e=>{
      e.preventDefault();
      const name = document.getElementById('p_name').value.trim();
      const price = parseFloat(document.getElementById('p_price').value);
      const description = document.getElementById('p_description').value.trim();
      const inStock = document.getElementById('p_instock').checked;
      if(!name){ showMsg('Nome do produto obrigatório', true); return; }
      createProduct({name, price, description, in_stock: inStock});
      e.target.reset();
    });

    document.getElementById('refreshProducts').addEventListener('click', ()=>listProducts());
  </script>

  <!-- Nota: caso haja restrição de CORS, sirva este arquivo via um servidor estático (ex.: 'python3 -m http.server') ou habilite CORS no backend. -->
</body>
</html>
